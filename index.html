.btn-secondary:hover {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            border-color: #1e3c72;
        }        .chart-type-btn:hover {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Data Analytics Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .main-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles - 25% */
        .sidebar {
            width: 25%;
            min-width: 320px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-right: 1px solid rgba(30, 60, 114, 0.2);
            box-shadow: 4px 0 25px rgba(30, 60, 114, 0.15);
            overflow-y: auto;
            max-height: 100vh;
        }

        .sidebar-header {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .sidebar-header h1 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .sidebar-content {
            padding: 15px;
        }

        .upload-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.1);
            margin-bottom: 15px;
            border: 2px solid #1e3c72;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #2a5298;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(30, 60, 114, 0.2);
        }

        .file-input-label {
            display: inline-block;
            padding: 10px 18px;
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .file-input {
            display: none;
        }

        .column-mapping-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.1);
            margin-bottom: 15px;
            border: 1px solid #1e3c72;
            display: none;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #1e3c72;
            background: linear-gradient(90deg, #1e3c72, #2a5298);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .mapping-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .mapping-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #1e3c72;
        }

        .mapping-select {
            padding: 6px;
            border: 2px solid #1e3c72;
            border-radius: 6px;
            font-size: 0.8rem;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #1e3c72;
            font-weight: 500;
        }

        .chart-config-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.1);
            margin-bottom: 15px;
            border: 1px solid #1e3c72;
            display: none;
        }

        .chart-type-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .chart-type-btn {
            padding: 8px;
            border: 2px solid #1e3c72;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            color: #1e3c72;
            font-weight: 600;
        }

        .chart-type-btn.active {
            border-color: #1e3c72;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);
        }

        .pivot-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.1);
            margin-bottom: 15px;
            border: 1px solid #1e3c72;
            display: none;
        }

        .pivot-config {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .pivot-group {
            margin-bottom: 8px;
        }

        .pivot-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 4px;
        }

        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 8px;
        }

        .filter-chip {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(30, 60, 114, 0.3);
            transition: all 0.3s ease;
        }

        .btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(30, 60, 114, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #ffffff, #f8f9fa);
            color: #1e3c72;
            border: 2px solid #1e3c72;
        }

        /* Main Content - 75% */
        .main-content {
            width: 75%;
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
        }

        .main-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.9) 100%);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            border: 2px solid rgba(30, 60, 114, 0.3);
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            color: #1e3c72;
            box-shadow: 0 8px 25px rgba(30, 60, 114, 0.1);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(30, 60, 114, 0.15);
            min-height: 400px;
            display: flex;
            flex-direction: column;
            border: 2px solid rgba(30, 60, 114, 0.1);
        }

        .chart-container.full-width {
            grid-column: 1 / -1;
            min-height: 450px;
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #1e3c72;
        }

        .chart-wrapper {
            flex: 1;
            position: relative;
            min-height: 300px;
        }

        .data-table-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .table-header {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            padding: 20px;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .table-container {
            max-height: 400px;
            overflow: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            color: #333;
            font-size: 0.8rem;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.9);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.1rem;
        }

        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 12px;
            border-radius: 6px;
            margin: 8px 0;
            font-size: 0.85rem;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                min-width: auto;
                max-height: none;
            }
            
            .main-content {
                width: 100%;
            }
        }

        /* Animation */
        .chart-container {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stats-summary {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            display: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1e3c72;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>📊 Universal Analytics</h1>
                <p>Smart Data Dashboard</p>
            </div>
            
            <div class="sidebar-content">
                <!-- Upload Section -->
                <div class="upload-section">
                    <div class="file-input-container">
                        <label for="file-input" class="file-input-label">
                            📁 Upload Data File
                        </label>
                        <input type="file" id="file-input" class="file-input" accept=".xlsx,.xls,.csv,.txt">
                        <p style="color: #666; text-align: center; font-size: 0.75rem; margin-top: 4px;">
                            Excel, CSV, or Tab-delimited files
                        </p>
                    </div>
                </div>

                <!-- Column Mapping Section -->
                <div class="column-mapping-section" id="column-mapping-section">
                    <div class="section-title">🔧 Column Mapping</div>
                    <div id="column-mappings">
                        <!-- Dynamic column mappings will be added here -->
                    </div>
                </div>

                <!-- Chart Configuration -->
                <div class="chart-config-section" id="chart-config-section">
                    <div class="section-title">📈 Chart Configuration</div>
                    
                    <div class="chart-type-grid">
                        <div class="chart-type-btn active" data-type="line">📈 Line</div>
                        <div class="chart-type-btn" data-type="bar">📊 Bar</div>
                        <div class="chart-type-btn" data-type="pie">🥧 Pie</div>
                        <div class="chart-type-btn" data-type="scatter">⚫ Scatter</div>
                        <div class="chart-type-btn" data-type="area">📊 Area</div>
                        <div class="chart-type-btn" data-type="doughnut">🍩 Doughnut</div>
                    </div>

                    <div class="mapping-group">
                        <div class="mapping-label">X-Axis</div>
                        <select class="mapping-select" id="x-axis-select">
                            <option value="">Select Column</option>
                        </select>
                    </div>

                    <div class="mapping-group">
                        <div class="mapping-label">Y-Axis</div>
                        <select class="mapping-select" id="y-axis-select">
                            <option value="">Select Column</option>
                        </select>
                    </div>

                    <div class="mapping-group">
                        <div class="mapping-label">Group By</div>
                        <select class="mapping-select" id="group-by-select">
                            <option value="">None</option>
                        </select>
                    </div>
                </div>

                <!-- Pivot Table Configuration -->
                <div class="pivot-section" id="pivot-section">
                    <div class="section-title">🔄 Pivot Table</div>
                    
                    <div class="pivot-config">
                        <div class="pivot-group">
                            <div class="pivot-label">Rows</div>
                            <select class="mapping-select" id="pivot-rows">
                                <option value="">Select Column</option>
                            </select>
                        </div>

                        <div class="pivot-group">
                            <div class="pivot-label">Columns</div>
                            <select class="mapping-select" id="pivot-columns">
                                <option value="">Select Column</option>
                            </select>
                        </div>

                        <div class="pivot-group">
                            <div class="pivot-label">Values</div>
                            <select class="mapping-select" id="pivot-values">
                                <option value="">Select Column</option>
                            </select>
                        </div>

                        <div class="pivot-group">
                            <div class="pivot-label">Aggregation</div>
                            <select class="mapping-select" id="pivot-aggregation">
                                <option value="sum">Sum</option>
                                <option value="count">Count</option>
                                <option value="avg">Average</option>
                                <option value="min">Minimum</option>
                                <option value="max">Maximum</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Statistics Summary -->
                <div class="stats-summary" id="stats-summary">
                    <div class="section-title">📊 Data Summary</div>
                    <div class="stats-grid" id="stats-grid">
                        <!-- Stats will be populated here -->
                    </div>
                </div>

                <!-- Controls -->
                <div class="chart-config-section" id="controls-section" style="display: none;">
                    <button class="btn" onclick="updateCharts()">🔄 Update Charts</button>
                    <button class="btn" onclick="createPivotTable()">📋 Generate Pivot</button>
                    <button class="btn btn-secondary" onclick="exportData()">💾 Export Data</button>
                    <button class="btn" onclick="generateReport()">📄 Generate Report</button>
                </div>

                <div class="loading" id="loading">
                    🔄 Processing data...
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="main-header">
                <h1>Universal Data Analytics Dashboard</h1>
                <p>Intelligent data visualization and analysis platform</p>
            </div>

            <div id="empty-state" class="empty-state">
                <h2>🚀 Welcome to Universal Analytics</h2>
                <p>Upload any data file to automatically generate insights, charts, and pivot tables</p>
                <p style="margin-top: 15px; font-size: 0.9rem;">
                    📊 <strong>Smart Features:</strong> Auto-detection of data types, intelligent column mapping, multiple chart types
                </p>
                <p style="margin-top: 10px; font-size: 0.85rem; opacity: 0.8;">
                    📋 <strong>Supported formats:</strong> Excel (.xlsx, .xls), CSV, Tab-delimited text files
                </p>
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <h3 style="color: #fff; margin-bottom: 10px;">✨ Intelligent Analysis</h3>
                    <p style="font-size: 0.9rem;">The dashboard automatically detects numeric, categorical, and date columns to create meaningful visualizations</p>
                </div>
            </div>

            <div id="dashboard-content" style="display: none;">
                <!-- Charts Grid -->
                <div class="dashboard-grid" id="charts-grid">
                    <!-- Charts will be dynamically added here -->
                </div>

                <!-- Pivot Table -->
                <div class="data-table-section" id="pivot-table-section" style="display: none;">
                    <div class="table-header">🔄 Pivot Table Analysis</div>
                    <div class="table-container">
                        <table id="pivot-table">
                            <thead id="pivot-head"></thead>
                            <tbody id="pivot-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Raw Data Table -->
                <div class="data-table-section" id="data-table-section">
                    <div class="table-header">📋 Raw Data (First 100 rows)</div>
                    <div class="table-container">
                        <table id="data-table">
                            <thead id="table-head"></thead>
                            <tbody id="table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let rawData = [];
        let processedData = [];
        let charts = {};
        let dataTypes = {};
        let currentChartType = 'line';

        // File upload handler
        document.getElementById('file-input').addEventListener('change', handleFile);

        // Chart type selection
        document.querySelectorAll('.chart-type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentChartType = this.dataset.type;
            });
        });

        function handleFile(e) {
            const file = e.target.files[0];
            if (!file) return;

            document.getElementById('loading').style.display = 'block';
            document.getElementById('empty-state').style.display = 'none';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data;
                    if (file.name.endsWith('.csv') || file.name.endsWith('.txt')) {
                        // Parse CSV/TSV
                        const text = e.target.result;
                        const delimiter = text.includes('\t') ? '\t' : ',';
                        const lines = text.split('\n').filter(line => line.trim());
                        const headers = lines[0].split(delimiter).map(h => h.trim().replace(/['"]/g, ''));
                        
                        data = lines.slice(1).map(line => {
                            const values = line.split(delimiter);
                            const row = {};
                            headers.forEach((header, index) => {
                                row[header] = values[index] ? values[index].trim().replace(/['"]/g, '') : '';
                            });
                            return row;
                        });
                    } else {
                        // Parse Excel
                        const arrayBuffer = e.target.result;
                        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        data = XLSX.utils.sheet_to_json(firstSheet, { defval: '' });
                    }
                    
                    console.log('📊 Raw data loaded:', data.length, 'rows');
                    console.log('🔑 Columns:', Object.keys(data[0] || {}));
                    
                    processUniversalData(data);
                } catch (error) {
                    console.error('File processing error:', error);
                    showError('Error reading file: ' + error.message);
                }
                document.getElementById('loading').style.display = 'none';
            };
            
            if (file.name.endsWith('.csv') || file.name.endsWith('.txt')) {
                reader.readAsText(file);
            } else {
                reader.readAsArrayBuffer(file);
            }
        }

        function processUniversalData(data) {
            if (!data || data.length === 0) {
                showError('No data found in file');
                return;
            }

            rawData = data.filter(row => 
                Object.values(row).some(value => 
                    value !== null && value !== undefined && value !== ''
                )
            );

            // Detect data types for each column
            dataTypes = detectDataTypes(rawData);
            console.log('🔍 Detected data types:', dataTypes);

            // Clean and process data
            processedData = rawData.map(row => {
                const processedRow = {};
                Object.keys(row).forEach(key => {
                    let value = row[key];
                    
                    if (dataTypes[key] === 'number') {
                        const numValue = parseFloat(String(value).replace(/[,%$]/g, ''));
                        processedRow[key] = isNaN(numValue) ? 0 : numValue;
                    } else if (dataTypes[key] === 'date') {
                        processedRow[key] = parseDate(value);
                    } else {
                        processedRow[key] = String(value).trim();
                    }
                });
                return processedRow;
            });

            setupColumnMappings();
            updateDataSummary();
            showAllSections();
            createDefaultCharts();
            updateDataTable();
        }

        function detectDataTypes(data) {
            const types = {};
            const sample = data.slice(0, Math.min(100, data.length));
            
            Object.keys(data[0] || {}).forEach(column => {
                const values = sample.map(row => row[column]).filter(v => v !== null && v !== undefined && v !== '');
                
                if (values.length === 0) {
                    types[column] = 'text';
                    return;
                }

                // Check if numeric
                const numericValues = values.filter(v => !isNaN(parseFloat(String(v).replace(/[,%$]/g, ''))));
                if (numericValues.length / values.length > 0.7) {
                    types[column] = 'number';
                    return;
                }

                // Check if date
                const dateValues = values.filter(v => !isNaN(Date.parse(v)));
                if (dateValues.length / values.length > 0.7) {
                    types[column] = 'date';
                    return;
                }

                // Check if categorical (limited unique values)
                const uniqueValues = new Set(values).size;
                if (uniqueValues <= Math.min(20, values.length * 0.1)) {
                    types[column] = 'category';
                    return;
                }

                types[column] = 'text';
            });

            return types;
        }

        function parseDate(value) {
            const date = new Date(value);
            return isNaN(date.getTime()) ? value : date;
        }

        function setupColumnMappings() {
            const columns = Object.keys(processedData[0] || {});
            const numericColumns = columns.filter(col => dataTypes[col] === 'number');
            const categoricalColumns = columns.filter(col => ['category', 'text'].includes(dataTypes[col]));
            const dateColumns = columns.filter(col => dataTypes[col] === 'date');

            // Populate selects
            populateSelect('x-axis-select', [...dateColumns, ...categoricalColumns, ...numericColumns]);
            populateSelect('y-axis-select', numericColumns);
            populateSelect('group-by-select', categoricalColumns);
            populateSelect('pivot-rows', categoricalColumns);
            populateSelect('pivot-columns', categoricalColumns);
            populateSelect('pivot-values', numericColumns);

            // Set default selections
            if (dateColumns.length > 0) {
                document.getElementById('x-axis-select').value = dateColumns[0];
            } else if (categoricalColumns.length > 0) {
                document.getElementById('x-axis-select').value = categoricalColumns[0];
            }

            if (numericColumns.length > 0) {
                document.getElementById('y-axis-select').value = numericColumns[0];
            }
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            
            // Clear existing options except first
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                select.appendChild(opt);
            });
        }

        function updateDataSummary() {
            const statsGrid = document.getElementById('stats-grid');
            const numericColumns = Object.keys(dataTypes).filter(col => dataTypes[col] === 'number');
            
            let statsHtml = `
                <div class="stat-item">
                    <div class="stat-value">${processedData.length.toLocaleString()}</div>
                    <div class="stat-label">Total Rows</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${Object.keys(dataTypes).length}</div>
                    <div class="stat-label">Columns</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${numericColumns.length}</div>
                    <div class="stat-label">Numeric</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${Object.values(dataTypes).filter(t => t === 'category').length}</div>
                    <div class="stat-label">Categorical</div>
                </div>
            `;

            statsGrid.innerHTML = statsHtml;
        }

        function createDefaultCharts() {
            const chartsGrid = document.getElementById('charts-grid');
            chartsGrid.innerHTML = '';

            const numericColumns = Object.keys(dataTypes).filter(col => dataTypes[col] === 'number');
            const categoricalColumns = Object.keys(dataTypes).filter(col => ['category', 'text'].includes(dataTypes[col]));
            const dateColumns = Object.keys(dataTypes).filter(col => dataTypes[col] === 'date');

            let chartCount = 0;

            // Time series chart if date columns exist
            if (dateColumns.length > 0 && numericColumns.length > 0) {
                createTimeSeriesChart(dateColumns[0], numericColumns[0], ++chartCount);
            }

            // Category breakdown chart
            if (categoricalColumns.length > 0 && numericColumns.length > 0) {
                createCategoryChart(categoricalColumns[0], numericColumns[0], ++chartCount);
            }

            // Numeric distribution
            if (numericColumns.length >= 2) {
                createScatterChart(numericColumns[0], numericColumns[1], ++chartCount);
            }

            // Top categories
            if (categoricalColumns.length > 0) {
                createTopCategoriesChart(categoricalColumns[0], ++chartCount);
            }
        }

        function createTimeSeriesChart(xCol, yCol, chartId) {
            const chartsGrid = document.getElementById('charts-grid');
            const chartContainer = document.createElement('div');
            chartContainer.className = 'chart-container';
            chartContainer.innerHTML = `
                <div class="chart-title">📈 ${yCol} over ${xCol}</div>
                <div class="chart-wrapper">
                    <canvas id="chart-${chartId}"></canvas>
                </div>
            `;
            chartsGrid.appendChild(chartContainer);

            // Group data by date
            const groupedData = _.groupBy(processedData, xCol);
            const sortedDates = Object.keys(groupedData).sort();
            
            const data = sortedDates.map(date => ({
                x: date,
                y: _.sumBy(groupedData[date], yCol)
            }));

            const ctx = document.getElementById(`chart-${chartId}`);
            charts[`chart-${chartId}`] = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: yCol,
                        data: data,
                        borderColor: '#1e3c72',
                        backgroundColor: 'rgba(30, 60, 114, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'category',
                            title: { display: true, text: xCol }
                        },
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: yCol }
                        }
                    }
                }
            });
        }

        function createCategoryChart(xCol, yCol, chartId) {
            const chartsGrid = document.getElementById('charts-grid');
            const chartContainer = document.createElement('div');
            chartContainer.className = 'chart-container';
            chartContainer.innerHTML = `
                <div class="chart-title">📊 ${yCol} by ${xCol}</div>
                <div class="chart-wrapper">
                    <canvas id="chart-${chartId}"></canvas>
                </div>
            `;
            chartsGrid.appendChild(chartContainer);

            // Group data by category
            const groupedData = _.groupBy(processedData, xCol);
            const categories = Object.keys(groupedData).slice(0, 10); // Top 10
            const values = categories.map(cat => _.sumBy(groupedData[cat], yCol));

            const ctx = document.getElementById(`chart-${chartId}`);
            charts[`chart-${chartId}`] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: [{
                        label: yCol,
                        data: values,
                        backgroundColor: 'rgba(30, 60, 114, 0.7)',
                        borderColor: '#1e3c72',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: yCol }
                        }
                    }
                }
            });
        }

        function createScatterChart(xCol, yCol, chartId) {
            const chartsGrid = document.getElementById('charts-grid');
            const chartContainer = document.createElement('div');
            chartContainer.className = 'chart-container';
            chartContainer.innerHTML = `
                <div class="chart-title">⚫ ${yCol} vs ${xCol}</div>
                <div class="chart-wrapper">
                    <canvas id="chart-${chartId}"></canvas>
                </div>
            `;
            chartsGrid.appendChild(chartContainer);

            const data = processedData.map(row => ({
                x: row[xCol],
                y: row[yCol]
            }));

            const ctx = document.getElementById(`chart-${chartId}`);
            charts[`chart-${chartId}`] = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: `${yCol} vs ${xCol}`,
                        data: data,
                        backgroundColor: 'rgba(30, 60, 114, 0.6)',
                        borderColor: '#1e3c72'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: { display: true, text: xCol }
                        },
                        y: {
                            title: { display: true, text: yCol }
                        }
                    }
                }
            });
        }

        function createTopCategoriesChart(col, chartId) {
            const chartsGrid = document.getElementById('charts-grid');
            const chartContainer = document.createElement('div');
            chartContainer.className = 'chart-container';
            chartContainer.innerHTML = `
                <div class="chart-title">🥧 Distribution by ${col}</div>
                <div class="chart-wrapper">
                    <canvas id="chart-${chartId}"></canvas>
                </div>
            `;
            chartsGrid.appendChild(chartContainer);

            // Count occurrences
            const counts = _.countBy(processedData, col);
            const sortedEntries = Object.entries(counts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            const labels = sortedEntries.map(entry => entry[0]);
            const values = sortedEntries.map(entry => entry[1]);

            const ctx = document.getElementById(`chart-${chartId}`);
            charts[`chart-${chartId}`] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: [
                            '#1e3c72', '#2a5298', '#4472c4', '#5b9bd5',
                            '#70ad47', '#ffc000', '#ff7f00', '#e74c3c',
                            '#9966cc', '#17a2b8'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        function updateCharts() {
            const xAxis = document.getElementById('x-axis-select').value;
            const yAxis = document.getElementById('y-axis-select').value;
            const groupBy = document.getElementById('group-by-select').value;

            if (!xAxis || !yAxis) {
                showError('Please select both X and Y axis columns');
                return;
            }

            // Clear existing charts
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
            charts = {};

            const chartsGrid = document.getElementById('charts-grid');
            chartsGrid.innerHTML = '';

            createCustomChart(xAxis, yAxis, groupBy, currentChartType);
        }

        function createCustomChart(xCol, yCol, groupCol, chartType) {
            const chartsGrid = document.getElementById('charts-grid');
            const chartContainer = document.createElement('div');
            chartContainer.className = 'chart-container full-width';
            chartContainer.innerHTML = `
                <div class="chart-title">📊 ${yCol} by ${xCol}${groupCol ? ` (grouped by ${groupCol})` : ''}</div>
                <div class="chart-wrapper">
                    <canvas id="custom-chart"></canvas>
                </div>
            `;
            chartsGrid.appendChild(chartContainer);

            let data, options;

            if (groupCol) {
                // Grouped data
                const groups = _.groupBy(processedData, groupCol);
                const datasets = Object.keys(groups).map((group, index) => {
                    const groupData = _.groupBy(groups[group], xCol);
                    const sortedKeys = Object.keys(groupData).sort();
                    
                    return {
                        label: group,
                        data: sortedKeys.map(key => _.sumBy(groupData[key], yCol)),
                        backgroundColor: `hsla(${210 + index * 30}, 70%, 50%, 0.7)`,
                        borderColor: `hsla(${210 + index * 30}, 70%, 50%, 1)`,
                        borderWidth: 2
                    };
                });

                const labels = [...new Set(processedData.map(row => row[xCol]))].sort();

                data = { labels, datasets };
            } else {
                // Simple aggregation
                const grouped = _.groupBy(processedData, xCol);
                const labels = Object.keys(grouped).sort();
                const values = labels.map(label => _.sumBy(grouped[label], yCol));

                data = {
                    labels,
                    datasets: [{
                        label: yCol,
                        data: values,
                        backgroundColor: 'rgba(30, 60, 114, 0.7)',
                        borderColor: '#1e3c72',
                        borderWidth: 2
                    }]
                };
            }

            options = {
                responsive: true,
                maintainAspectRatio: false,
                scales: chartType === 'pie' || chartType === 'doughnut' ? {} : {
                    x: { title: { display: true, text: xCol } },
                    y: { 
                        beginAtZero: true,
                        title: { display: true, text: yCol }
                    }
                }
            };

            const ctx = document.getElementById('custom-chart');
            charts['custom-chart'] = new Chart(ctx, {
                type: chartType,
                data: data,
                options: options
            });
        }

        function createPivotTable() {
            const rowsCol = document.getElementById('pivot-rows').value;
            const columnsCol = document.getElementById('pivot-columns').value;
            const valuesCol = document.getElementById('pivot-values').value;
            const aggregation = document.getElementById('pivot-aggregation').value;

            if (!rowsCol || !valuesCol) {
                showError('Please select at least Rows and Values for pivot table');
                return;
            }

            const pivotData = generatePivotData(rowsCol, columnsCol, valuesCol, aggregation);
            displayPivotTable(pivotData, rowsCol, columnsCol, valuesCol);
        }

        function generatePivotData(rowsCol, columnsCol, valuesCol, aggregation) {
            const result = {};
            const columnValues = columnsCol ? [...new Set(processedData.map(row => row[columnsCol]))].sort() : [null];

            processedData.forEach(row => {
                const rowKey = row[rowsCol];
                if (!result[rowKey]) {
                    result[rowKey] = {};
                    columnValues.forEach(colVal => {
                        result[rowKey][colVal || 'Total'] = [];
                    });
                }

                const colKey = columnsCol ? row[columnsCol] : 'Total';
                if (result[rowKey][colKey]) {
                    result[rowKey][colKey].push(row[valuesCol]);
                }
            });

            // Apply aggregation
            Object.keys(result).forEach(rowKey => {
                Object.keys(result[rowKey]).forEach(colKey => {
                    const values = result[rowKey][colKey];
                    if (values.length === 0) {
                        result[rowKey][colKey] = 0;
                    } else {
                        switch (aggregation) {
                            case 'sum':
                                result[rowKey][colKey] = _.sum(values);
                                break;
                            case 'avg':
                                result[rowKey][colKey] = _.mean(values);
                                break;
                            case 'count':
                                result[rowKey][colKey] = values.length;
                                break;
                            case 'min':
                                result[rowKey][colKey] = _.min(values);
                                break;
                            case 'max':
                                result[rowKey][colKey] = _.max(values);
                                break;
                        }
                    }
                });
            });

            return { data: result, columns: columnValues };
        }

        function displayPivotTable(pivotData, rowsCol, columnsCol, valuesCol) {
            const pivotHead = document.getElementById('pivot-head');
            const pivotBody = document.getElementById('pivot-body');

            // Create headers
            const headers = [rowsCol, ...pivotData.columns.map(col => col || 'Total')];
            pivotHead.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>`;

            // Create rows
            const rows = Object.keys(pivotData.data).sort();
            pivotBody.innerHTML = rows.map(row => {
                const values = pivotData.columns.map(col => {
                    const value = pivotData.data[row][col || 'Total'];
                    return typeof value === 'number' ? value.toLocaleString() : value;
                });
                return `<tr><td><strong>${row}</strong></td>${values.map(v => `<td>${v}</td>`).join('')}</tr>`;
            }).join('');

            document.getElementById('pivot-table-section').style.display = 'block';
        }

        function updateDataTable() {
            const thead = document.getElementById('table-head');
            const tbody = document.getElementById('table-body');

            if (processedData.length === 0) return;

            const columns = Object.keys(processedData[0]);
            
            // Create header
            thead.innerHTML = `<tr>${columns.map(col => `<th>${col}</th>`).join('')}</tr>`;
            
            // Create rows (limit to first 100)
            tbody.innerHTML = processedData.slice(0, 100).map(row => 
                `<tr>${columns.map(col => {
                    let value = row[col];
                    if (typeof value === 'number') {
                        value = value.toLocaleString();
                    }
                    return `<td>${value}</td>`;
                }).join('')}</tr>`
            ).join('');
        }

        function showAllSections() {
            document.getElementById('column-mapping-section').style.display = 'block';
            document.getElementById('chart-config-section').style.display = 'block';
            document.getElementById('pivot-section').style.display = 'block';
            document.getElementById('stats-summary').style.display = 'block';
            document.getElementById('controls-section').style.display = 'block';
            document.getElementById('dashboard-content').style.display = 'block';
        }

        function exportData() {
            if (processedData.length === 0) {
                alert('No data to export!');
                return;
            }
            
            const headers = Object.keys(processedData[0]);
            const csvContent = [
                headers.join(','),
                ...processedData.map(row => 
                    headers.map(header => `"${row[header] || ''}"`).join(',')
                )
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `analytics_export_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function generateReport() {
            if (processedData.length === 0) {
                alert('No data available for report generation!');
                return;
            }

            const numericColumns = Object.keys(dataTypes).filter(col => dataTypes[col] === 'number');
            const categoricalColumns = Object.keys(dataTypes).filter(col => ['category', 'text'].includes(dataTypes[col]));
            
            const stats = numericColumns.map(col => {
                const values = processedData.map(row => row[col]).filter(v => !isNaN(v));
                return {
                    column: col,
                    count: values.length,
                    sum: _.sum(values),
                    mean: _.mean(values),
                    min: _.min(values),
                    max: _.max(values)
                };
            });

            const categoryStats = categoricalColumns.map(col => {
                const counts = _.countBy(processedData, col);
                const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
                return {
                    column: col,
                    uniqueValues: Object.keys(counts).length,
                    topValues: sorted.slice(0, 5)
                };
            });

            const reportContent = `
UNIVERSAL DATA ANALYTICS REPORT
===============================
Generated: ${new Date().toLocaleString()}
Dataset: ${processedData.length.toLocaleString()} rows, ${Object.keys(dataTypes).length} columns

DATA OVERVIEW
-------------
Total Records: ${processedData.length.toLocaleString()}
Numeric Columns: ${numericColumns.length}
Categorical Columns: ${categoricalColumns.length}
Date Columns: ${Object.values(dataTypes).filter(t => t === 'date').length}

NUMERIC STATISTICS
------------------
${stats.map(stat => `
${stat.column}:
  Count: ${stat.count.toLocaleString()}
  Sum: ${stat.sum.toLocaleString()}
  Average: ${stat.mean.toFixed(2)}
  Range: ${stat.min} - ${stat.max}
`).join('')}

CATEGORICAL ANALYSIS
--------------------
${categoryStats.map(stat => `
${stat.column}:
  Unique Values: ${stat.uniqueValues}
  Top Categories: ${stat.topValues.map(([name, count]) => `${name} (${count})`).join(', ')}
`).join('')}

DATA QUALITY
------------
Missing Values: Automatically handled during processing
Data Types: Automatically detected and converted
Outliers: Consider manual review of extreme values

RECOMMENDATIONS
---------------
• Review data quality and completeness
• Consider additional filtering for analysis
• Explore correlations between numeric variables
• Analyze trends over time if date columns are present
• Investigate top categories for business insights

This report was generated by Universal Data Analytics Dashboard.
            `;

            const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `analytics_report_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.sidebar-content').appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>
